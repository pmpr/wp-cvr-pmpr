<div class="dropdown-menu right-0 left-auto border-0 mt-1 py-0 cart-dropdown"
     aria-labelledby="cart_content">
    <form>
        {{ get_spinner({})|raw }}
        <div class="card rounded border-gray-300">
            <div class="card-header border-gray-300 bg-transparent d-flex justify-content-between px-3 py-2 font-14 shadow-sm">
                <span class="text-gray-700">{{ count_text|raw }}</span>
                {{ cart_link|raw }}
            </div>
            <div id="cart_content_list_holder" class="card-body bg-transparent px-3 py-0">
                {{ the_widget(widget, 'title=')|raw }}
            </div>
            <script>
                function refreshFragment($selector, $content) {
                    let $el = document.querySelector($selector);
                    if ($el) {

                        $el.innerHTML = $content;
                    }
                }

                if (document.readyState === 'loading' || document.readyState) {

                    let event = 'DOMContentLoaded',
                        $callback = () => {
                            PMPRInlineUtil.ajaxRequest({
                                action: '{{ get_count_ajax_action|esc_attr }}'
                            }, (response) => {
                                let $fragments = response.fragments;
                                if (typeof $fragments === "object") {
                                    if (Array.isArray($fragments)) {


                                    } else {
                                        for (const [selector, content] of Object.entries($fragments)) {

                                            refreshFragment(selector, content);
                                        }
                                    }
                                }
                            });
                        };
                    if (window.addEventListener) {

                        window.addEventListener(event, $callback)
                    } else {
                        window.attachEvent('on' + event, $callback)
                    }
                }
            </script>
        </div>
    </form>
</div>
